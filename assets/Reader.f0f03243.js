import{k as g,l as W,_ as X,m as Z,n as ee,b as te,s as oe,a as ae,p as le,q as k,v as y,x as ne,y as ie,z as se,A as re,r as B,o as d,c as m,d as i,w as h,B as s,C as z,D as $,E as l,G as ce,H as _,g as I,F,e as de,I as ue,t as w,J as me,j as R,K as fe,L as pe}from"./index.e3879f0a.js";import{V as ve}from"./VSnackbar.2be2db85.js";function he(a){return g.post("/star",null,{params:{itemId:a}})}function _e(a){return g.delete("/star",{params:{itemId:a}})}function $e(a){return g.get("/star/articles",{params:a})}function ye(a){return g.get("/proxy/html-text",{params:a})}async function we(a,r){return r=="text"?await xe(a):r=="html"?await Y(a):await Y(a)}async function Y(a){return(location.hostname.includes("localhost")?"http://localhost:8080/api":"https://api.webfollow.cc/api")+"/proxy/html-text?url="+a}async function xe(a){let r=await ye({url:a});return Te(r).content}function Te(a){var r=document.implementation.createHTMLDocument("doc");r.documentElement.innerHTML=a;var p=new W.Readability(r.cloneNode(!0)).parse();return p}const ke={class:"read"},ge=["title"],be=["title"],Ce=["title"],Ve=["title"],Se=["title"],Le=["title"],Re={key:0,class:""},De=["src"],He={key:1},Ue={key:1,class:"mr-3 mt-3"},Ae=["href"],Ee=["textContent"],Me={class:"mx-auto normalize"},Ne={__name:"Reader",props:["modelValue","overY","ctrlStyle","hiddeUpAndDown"],emits:["update:modelValue"],setup(a,{emit:r}){const p=a,j=Z(),q=ee(),{t:P}=te();function v(e){return P("reader."+e)}const{token:G}=oe(ae()),{mobile:J}=le(),o=k(()=>p.modelValue),D=k(()=>p.overY),K=k(()=>p.ctrlStyle||{}),O=k(()=>p.hiddeUpAndDown||!1),b=y(!1),u=y(void 0),f=ne({show:!1,msg:void 0}),x=e=>r("update:modelValue",e),H=y(),C=y(),V=y("00:00");function U(e){document.dispatchEvent(pe(e))}function S(){return D.value?C.value:H.value.$el}async function A(){let e=o.value;try{e.star?await _e(e.id):await he(e.id),e.star=!e.star,x(e)}catch{f.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",f.show=!0}}async function T(e){if(e==u.value){let t=o.value;u.value=void 0,t.descriptionText=void 0,x(t);return}await E(e)}async function E(e){let t=o.value;b.value=!0;try{let n=await we(t.link,e);u.value=e,t.descriptionText=n,x(t)}catch{f.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",f.show=!0}b.value=!1}function M(){x({})}function Q(){let e=C.value.getElementsByTagName("a");for(let t of e){let n=new URL(t.href);if(n.hash.indexOf("#t")==0&&n.host==window.location.host){let c=function(){q.pushHash(L),N()},L=window.location.hash.replace("#","").split("?")[0]+n.hash.replace("#t","?t");t.href="javascript: void(0)",t.onclick=c}}N()}function N(){let e=j,t=window.location.href.replace("/#/","/"),n=new URL(t).searchParams.get("t")||e.query.t;n&&o.value.itunesDuration&&(V.value=n)}return ie(()=>{se(o,e=>{e.id&&(S().scrollTop=0),u.value&&E(u.value)}),Q(),re(async e=>{if(e.detail=="rendText")T("text");else if(e.detail=="rendHtml")T("html");else if(e.detail=="readerQuit")M();else if(e.detail=="readerStar")A();else if(e.detail=="top"){let t=S();for(let n=0;n<40;n+=10)setTimeout(()=>{t.scrollTop-=10},n*2)}else if(e.detail=="bottom"){let t=S();for(let n=0;n<40;n+=10)setTimeout(()=>{t.scrollTop+=10},n*2)}else if(e.detail=="openTarget"){let t=window.open("about:blank");t.location.href=o.value.link}})}),(e,t)=>{const n=B("c-m-player"),L=B("router-link");return d(),m(F,null,[i(z,{ref_key:"reader0",ref:H,loading:b.value},{default:h(()=>[s("div",{ref_key:"reader1",ref:C,class:$(["read-box",{"over-y":l(D)}]),tabindex:"0"},[s("div",ke,[i(z,{class:$(["ctrl side",{"ctrl-mobile":l(J)}]),style:ce(l(K))},{default:h(()=>[s("div",{class:"ctrl-item",title:v("fetchSourceText")},[i(_,{icon:"mdi:mdi-book-open",color:u.value=="text"?"primary":"",onClick:t[0]||(t[0]=c=>T("text"))},null,8,["color"])],8,ge),s("div",{class:"ctrl-item",title:v("iframe")},[i(_,{icon:"mdi:mdi-google-chrome",color:u.value=="html"?"primary":"",onClick:t[1]||(t[1]=c=>T("html"))},null,8,["color"])],8,be),l(G)?(d(),m("div",{key:0,class:"ctrl-item",title:v("start")},[i(_,{icon:"mdi:mdi-star"+(l(o).star?"":"-outline"),variant:"outlined",color:l(o).star?"primary":"",onClick:A},null,8,["icon","color"])],8,Ce)):I("",!0),l(O)?I("",!0):(d(),m(F,{key:1},[s("div",{class:"ctrl-item",title:v("upAriticle")},[i(_,{icon:"mdi:mdi-chevron-up",onClick:t[2]||(t[2]=c=>U("up"))})],8,Ve),s("div",{class:"ctrl-item",title:v("downAriticle")},[i(_,{icon:"mdi:mdi-chevron-down",onClick:t[3]||(t[3]=c=>U("down"))})],8,Se)],64)),s("div",{class:"ctrl-item",title:v("close")},[i(_,{icon:"mdi:mdi-close",onClick:M})],8,Le)]),_:1},8,["class","style"]),u.value=="html"?(d(),m("div",Re,[s("iframe",{src:l(o).descriptionText,frameborder:"0",class:"read-box",width:"100%"},null,8,De)])):(d(),m("div",He,[s("div",null,[l(o).itunesDuration?(d(),de(n,{key:0,"song-info":l(o),autoplay:!0,currentTime:V.value,"onUpdate:currentTime":t[4]||(t[4]=c=>V.value=c)},null,8,["song-info","currentTime"])):(d(),m("div",Ue,[i(ue,{class:"text-ellipsis",style:{"font-size":"1.6em"}},{default:h(()=>[l(o).link?(d(),m("a",{key:0,target:"_blank",href:l(o).link},w(l(o).title),9,Ae)):(d(),m("span",{key:1,textContent:w(l(o).title)},null,8,Ee))]),_:1})])),i(me,{class:"mb-2 mt-1"},{default:h(()=>[i(L,{to:"/channel/"+l(o).channelId},{default:h(()=>[R(w(l(o).channelName),1)]),_:1},8,["to"]),R(" "+w(l(o).pubDateTime),1)]),_:1})]),s("div",Me,[i(fe,{ref:"description",innerHTML:l(o).descriptionText||l(o).description,class:"read-warp"},null,8,["innerHTML"])])]))])],2)]),_:1},8,["loading"]),i(ve,{location:"top",timeout:2e3,modelValue:f.show,"onUpdate:modelValue":t[5]||(t[5]=c=>f.show=c)},{default:h(()=>[R(w(f.msg),1)]),_:1},8,["modelValue"])],64)}}},Ie=X(Ne,[["__scopeId","data-v-a62032bd"]]);export{Ie as R,$e as f};
