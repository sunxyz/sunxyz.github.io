import{j as k,k as A,_ as U,a as j,s as q,l as G,m as Q,n as V,p as x,q as J,v as z,x as K,y as O,r as P,o as d,c as u,b as s,w as m,z as i,A as D,B,C as o,D as W,E as y,e as X,G as Z,t as p,H as ee,h as C,I as te,F as ae}from"./index.d851babc.js";import{V as le}from"./VSnackbar.bf87abd4.js";function oe(t){return k.post("/star",null,{params:{itemId:t}})}function se(t){return k.delete("/star",{params:{itemId:t}})}function Ve(t){return k.get("/star/articles",{params:t})}function ne(t){return k.get("/proxy/html-text",{params:t})}async function ie(t,n){return n=="text"?await re(t):n=="html"?await E(t):await E(t)}async function E(t){return(location.hostname.includes("localhost")?"http://localhost:8080/api":"https://api.webfollow.cc/api")+"/proxy/html-text?url="+t}async function re(t){let n=await ne({url:t});return ce(n).content}function ce(t){var n=document.implementation.createHTMLDocument("doc");n.documentElement.innerHTML=t;var f=new A.Readability(n.cloneNode(!0)).parse();return f}const de={class:"read"},ue=["title"],me=["title"],fe=["title"],pe=["title"],_e={key:0,class:""},ve=["src"],he={key:1,class:"normalize"},xe={class:"mr-3 mt-3"},ye=["href"],ke=["textContent"],Te={class:"mx-auto"},we={__name:"Reader",props:["modelValue","overY","ctrlStyle"],emits:["update:modelValue"],setup(t,{emit:n}){const f=t,{t:I}=j();function _(e){return I("reader."+e)}const{token:F}=q(G()),{mobile:Y}=Q(),a=V(()=>f.modelValue),S=V(()=>f.overY),$=V(()=>f.ctrlStyle||{}),T=x(!1),r=x(void 0),c=J({show:!1,msg:void 0}),v=e=>n("update:modelValue",e),H=x(),L=x();function w(){return S.value?L.value:H.value.$el}z(()=>{K(a,e=>{e.id&&(w().scrollTop=0),r.value&&M(r.value)})});async function R(){let e=a.value;try{e.star?await se(e.id):await oe(e.id),e.star=!e.star,v(e)}catch{c.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",c.show=!0}}async function h(e){if(e==r.value){let l=a.value;r.value=void 0,l.descriptionText=void 0,v(l);return}await M(e)}async function M(e){let l=a.value;T.value=!0;try{let b=await ie(l.link,e);r.value=e,l.descriptionText=b,v(l)}catch{c.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",c.show=!0}T.value=!1}function N(){v({})}return z(()=>{O(async e=>{if(e.detail=="rendText")h("text");else if(e.detail=="rendHtml")h("html");else if(e.detail=="readerQuit")N();else if(e.detail=="readerStar")R();else if(e.detail=="top")w().scrollTop-=50;else if(e.detail=="bottom")w().scrollTop+=50;else if(e.detail=="openTarget"){let l=window.open("about:blank");l.location.href=a.value.link}})}),(e,l)=>{const b=P("router-link");return d(),u(ae,null,[s(D,{ref_key:"reader0",ref:H,loading:T.value},{default:m(()=>[i("div",{ref_key:"reader1",ref:L,class:B(["read-box",{"over-y":o(S)}]),tabindex:"0"},[i("div",de,[s(D,{class:B(["ctrl side",{"ctrl-mobile":o(Y)}]),style:W(o($))},{default:m(()=>[i("div",{class:"ctrl-item",title:_("fetchSourceText")},[s(y,{icon:"mdi:mdi-book-open",color:r.value=="text"?"primary":"",onClick:l[0]||(l[0]=g=>h("text"))},null,8,["color"])],8,ue),i("div",{class:"ctrl-item",title:_("iframe")},[s(y,{icon:"mdi:mdi-google-chrome",color:r.value=="html"?"primary":"",onClick:l[1]||(l[1]=g=>h("html"))},null,8,["color"])],8,me),o(F)?(d(),u("div",{key:0,class:"ctrl-item",title:_("start")},[s(y,{icon:"mdi:mdi-star"+(o(a).star?"":"-outline"),variant:"outlined",color:o(a).star?"primary":"",onClick:R},null,8,["icon","color"])],8,fe)):X("",!0),i("div",{class:"ctrl-item",title:_("close")},[s(y,{icon:"mdi:mdi-close",onClick:N})],8,pe)]),_:1},8,["class","style"]),r.value=="html"?(d(),u("div",_e,[i("iframe",{src:o(a).descriptionText,frameborder:"0",class:"read-box",width:"100%"},null,8,ve)])):(d(),u("div",he,[i("div",null,[i("div",xe,[s(Z,{class:"text-ellipsis",style:{"max-width":"90%","font-size":"2em"}},{default:m(()=>[o(a).link?(d(),u("a",{key:0,target:"_blank",href:o(a).link},p(o(a).title),9,ye)):(d(),u("span",{key:1,textContent:p(o(a).title)},null,8,ke))]),_:1})]),s(ee,{class:"mb-2 mt-1"},{default:m(()=>[s(b,{to:"/channel/"+o(a).channelId},{default:m(()=>[C(p(o(a).channelName),1)]),_:1},8,["to"]),C(" "+p(o(a).pubDateTime),1)]),_:1})]),i("div",Te,[s(te,{innerHTML:o(a).descriptionText||o(a).description,class:"read-warp"},null,8,["innerHTML"])])]))])],2)]),_:1},8,["loading"]),s(le,{location:"top",timeout:2e3,modelValue:c.show,"onUpdate:modelValue":l[2]||(l[2]=g=>c.show=g)},{default:m(()=>[C(p(c.msg),1)]),_:1},8,["modelValue"])],64)}}},Ce=U(we,[["__scopeId","data-v-bd4d987c"]]);export{Ce as R,Ve as f};
