import{h as y,j as F,_ as I,s as Y,k as $,l as b,m as h,n as q,p as N,q as A,t as U,r as j,o as d,c as u,a as n,w as m,v as r,x as z,y as G,z as o,A as x,d as Q,B as J,C as p,D as K,g as V,E as O,G as P,F as W}from"./index.c8e0246a.js";import{V as X}from"./VSnackbar.de78c1b5.js";function Z(t){return y.post("/star",null,{params:{itemId:t}})}function ee(t){return y.delete("/star",{params:{itemId:t}})}function ye(t){return y.get("/star/articles",{params:t})}function te(t){return y.get("/proxy/html-text",{params:t})}async function ae(t,s){return s=="text"?await le(t):s=="html"?await B(t):await B(t)}async function B(t){return(location.hostname.includes("localhost")?"http://localhost:8080/api":"https://api.webfollow.cc/api")+"/proxy/html-text?url="+t}async function le(t){let s=await te({url:t});return oe(s).content}function oe(t){var s=document.implementation.createHTMLDocument("doc");s.documentElement.innerHTML=t;var f=new F.Readability(s.cloneNode(!0)).parse();return f}const ne={class:"ctrl-item",title:"\u52A0\u8F7D\u7F51\u9875\u6587\u672C-\u9605\u8BFB\u6A21\u5F0F \u5FEB\u6377\u952E(r)"},se={class:"ctrl-item",title:"\u5185\u5D4C\u7F51\u9875 \u5FEB\u6377\u952E(e)"},ie={key:0,class:"ctrl-item",title:"\u6536\u85CF \u5FEB\u6377\u952E(ctrl+alt+s)"},re={class:"ctrl-item",title:"\u5173\u95ED \u5FEB\u6377\u952E(q)"},ce={key:0,class:"read"},de=["src"],ue={key:1,class:"normalize read"},me={class:"mr-3 mt-3"},fe=["href"],pe=["textContent"],_e={class:"mx-auto"},ve={__name:"Reader",props:["modelValue","overY","ctrlStyle"],emits:["update:modelValue"],setup(t,{emit:s}){const f=t,{token:D}=Y($()),a=b(()=>f.modelValue),C=b(()=>f.overY),E=b(()=>f.ctrlStyle||{}),k=h(!1),i=h(void 0),c=q({show:!1,msg:void 0}),_=e=>s("update:modelValue",e),S=h(),R=h();function w(){return C.value?R.value:S.value.$el}N(()=>{A(a,e=>{e.id&&(w().scrollTop=0),i.value&&L(i.value)})});async function H(){let e=a.value;try{e.star?await ee(e.id):await Z(e.id),e.star=!e.star,_(e)}catch{c.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",c.show=!0}}async function v(e){if(e==i.value){let l=a.value;i.value=void 0,l.descriptionText=void 0,_(l);return}await L(e)}async function L(e){let l=a.value;k.value=!0;try{let T=await ae(l.link,e);i.value=e,l.descriptionText=T,_(l)}catch{c.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",c.show=!0}k.value=!1}function M(){_({})}return N(()=>{U(async e=>{if(e.detail=="rendText")v("text");else if(e.detail=="rendHtml")v("html");else if(e.detail=="readerQuit")M();else if(e.detail=="readerStar")H();else if(e.detail=="top")w().scrollTop-=50;else if(e.detail=="bottom")w().scrollTop+=50;else if(e.detail=="openTarget"){let l=window.open("about:blank");l.location.href=a.value.link}})}),(e,l)=>{const T=j("router-link");return d(),u(W,null,[n(z,{ref_key:"reader0",ref:S,loading:k.value},{default:m(()=>[r("div",{ref_key:"reader1",ref:R,class:P(["read-box",{"over-y":o(C)}]),tabindex:"0"},[n(z,{class:"ctrl",style:G(o(E)),width:"50px"},{default:m(()=>[r("div",ne,[n(x,{icon:"mdi:mdi-book-open",color:i.value=="text"?"indigo":"",onClick:l[0]||(l[0]=g=>v("text"))},null,8,["color"])]),r("div",se,[n(x,{icon:"mdi:mdi-google-chrome",color:i.value=="html"?"indigo":"",onClick:l[1]||(l[1]=g=>v("html"))},null,8,["color"])]),o(D)?(d(),u("div",ie,[n(x,{icon:"mdi:mdi-star"+(o(a).star?"":"-outline"),variant:"outlined",color:o(a).star?"indigo":"",onClick:H},null,8,["icon","color"])])):Q("",!0),r("div",re,[n(x,{icon:"mdi:mdi-close",onClick:M})])]),_:1},8,["style"]),i.value=="html"?(d(),u("div",ce,[r("iframe",{src:o(a).descriptionText,frameborder:"0",class:"read-box",width:"100%"},null,8,de)])):(d(),u("div",ue,[r("div",null,[r("div",me,[n(J,{class:"text-ellipsis",style:{"max-width":"90%","font-size":"2em"}},{default:m(()=>[o(a).link?(d(),u("a",{key:0,target:"_blank",href:o(a).link},p(o(a).title),9,fe)):(d(),u("span",{key:1,textContent:p(o(a).title)},null,8,pe))]),_:1})]),n(K,{class:"mb-2 mt-1"},{default:m(()=>[n(T,{to:"/channel/"+o(a).channelId},{default:m(()=>[V(p(o(a).channelName),1)]),_:1},8,["to"]),V(" "+p(o(a).pubDateTime),1)]),_:1})]),r("div",_e,[n(O,{innerHTML:o(a).descriptionText||o(a).description,class:"read-warp"},null,8,["innerHTML"])])]))],2)]),_:1},8,["loading"]),n(X,{location:"top",timeout:2e3,modelValue:c.show,"onUpdate:modelValue":l[2]||(l[2]=g=>c.show=g)},{default:m(()=>[V(p(c.msg),1)]),_:1},8,["modelValue"])],64)}}},ke=I(ve,[["__scopeId","data-v-4348f55b"]]);export{ke as R,ye as f};
