import{k as g,l as W,_ as X,m as Z,n as ee,p as te,b as oe,s as ae,a as le,q as ne,v as k,x as T,y as se,z as ie,A as re,B as ce,r as U,o as c,c as u,d as s,w as v,C as i,D as B,E as z,G as l,H as de,I as _,g as $,F as I,e as ue,J as me,t as y,K as fe,j as L,L as pe,M as he}from"./index.3ad06852.js";import{V as ve}from"./VSnackbar.d8195d91.js";function _e(a){return g.post("/star",null,{params:{itemId:a}})}function ye(a){return g.delete("/star",{params:{itemId:a}})}function Ie(a){return g.get("/star/articles",{params:a})}function we(a){return g.get("/proxy/html-text",{params:a})}async function xe(a,r){return r=="text"?await ke(a):r=="html"?await F(a):await F(a)}async function F(a){return(location.hostname.includes("localhost")?"http://localhost:8080/api":"https://api.webfollow.cc/api")+"/proxy/html-text?url="+a}async function ke(a){let r=await we({url:a});return Te(r).content}function Te(a){var r=document.implementation.createHTMLDocument("doc");r.documentElement.innerHTML=a;var p=new W.Readability(r.cloneNode(!0)).parse();return p}const ge={class:"read"},be=["title"],Ce=["title"],Ve=["title"],Se=["title"],Le=["title"],Re=["title"],De={key:0,class:""},Me=["src"],He={key:1},Ae={key:1,class:"mr-3 mt-3"},Ee=["href"],Ne=["textContent"],Ue={class:"mx-auto normalize"},Be={__name:"Reader",props:["modelValue","overY","ctrlStyle","hiddeUpAndDown"],emits:["update:modelValue"],setup(a,{emit:r}){const p=a,{setCurrentTime:P}=Z(),Y=ee(),j=te(),{t:q}=oe();function h(e){return q("reader."+e)}const{token:G}=ae(le()),{mobile:J}=ne(),o=k(()=>p.modelValue),R=k(()=>p.overY),K=k(()=>p.ctrlStyle||{}),O=k(()=>p.hiddeUpAndDown||!1),b=T(!1),d=T(void 0),m=se({show:!1,msg:void 0}),w=e=>r("update:modelValue",e),D=T(),C=T();function M(e){document.dispatchEvent(he(e))}function V(){return R.value?C.value:D.value.$el}async function H(){let e=o.value;try{e.star?await ye(e.id):await _e(e.id),e.star=!e.star,w(e)}catch{m.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",m.show=!0}}async function x(e){if(e==d.value){let t=o.value;d.value=void 0,t.descriptionText=void 0,w(t);return}await A(e)}async function A(e){let t=o.value;b.value=!0;try{let n=await xe(t.link,e);d.value=e,t.descriptionText=n,w(t)}catch{m.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",m.show=!0}b.value=!1}function E(){w({})}function Q(){let e=C.value.getElementsByTagName("a");for(let t of e){let n=new URL(t.href);if(n.hash.indexOf("#t")==0&&n.host==window.location.host){let f=function(){j.pushHash(S),N()},S=window.location.hash.replace("#","").split("?")[0]+n.hash.replace("#t","?t");t.href="javascript: void(0)",t.onclick=f}}N()}function N(){let e=Y,t=window.location.href.replace("/#/","/"),n=new URL(t).searchParams.get("t")||e.query.t;n&&o.value.itunesDuration&&P(n)}return ie(()=>{re(o,e=>{e.id&&(V().scrollTop=0),d.value&&A(d.value)}),Q(),ce(async e=>{if(e.detail=="rendText")x("text");else if(e.detail=="rendHtml")x("html");else if(e.detail=="readerQuit")E();else if(e.detail=="readerStar")H();else if(e.detail=="top"){let t=V();for(let n=0;n<40;n+=10)setTimeout(()=>{t.scrollTop-=10},n*2)}else if(e.detail=="bottom"){let t=V();for(let n=0;n<40;n+=10)setTimeout(()=>{t.scrollTop+=10},n*2)}else if(e.detail=="openTarget"){let t=window.open("about:blank");t.location.href=o.value.link}})}),(e,t)=>{const n=U("c-m-player"),S=U("router-link");return c(),u(I,null,[s(B,{ref_key:"reader0",ref:D,loading:b.value},{default:v(()=>[i("div",{ref_key:"reader1",ref:C,class:z(["read-box",{"over-y":l(R)}]),tabindex:"0"},[i("div",ge,[s(B,{class:z(["ctrl side",{"ctrl-mobile":l(J)}]),style:de(l(K))},{default:v(()=>[i("div",{class:"ctrl-item",title:h("fetchSourceText")},[s(_,{icon:"mdi:mdi-book-open",color:d.value=="text"?"primary":"",onClick:t[0]||(t[0]=f=>x("text"))},null,8,["color"])],8,be),i("div",{class:"ctrl-item",title:h("iframe")},[s(_,{icon:"mdi:mdi-google-chrome",color:d.value=="html"?"primary":"",onClick:t[1]||(t[1]=f=>x("html"))},null,8,["color"])],8,Ce),l(G)?(c(),u("div",{key:0,class:"ctrl-item",title:h("start")},[s(_,{icon:"mdi:mdi-star"+(l(o).star?"":"-outline"),variant:"outlined",color:l(o).star?"primary":"",onClick:H},null,8,["icon","color"])],8,Ve)):$("",!0),l(O)?$("",!0):(c(),u(I,{key:1},[i("div",{class:"ctrl-item",title:h("upAriticle")},[s(_,{icon:"mdi:mdi-chevron-up",onClick:t[2]||(t[2]=f=>M("up"))})],8,Se),i("div",{class:"ctrl-item",title:h("downAriticle")},[s(_,{icon:"mdi:mdi-chevron-down",onClick:t[3]||(t[3]=f=>M("down"))})],8,Le)],64)),i("div",{class:"ctrl-item",title:h("close")},[s(_,{icon:"mdi:mdi-close",onClick:E})],8,Re)]),_:1},8,["class","style"]),d.value=="html"?(c(),u("div",De,[i("iframe",{src:l(o).descriptionText,frameborder:"0",class:"read-box",width:"100%"},null,8,Me)])):(c(),u("div",He,[i("div",null,[l(o).itunesDuration?(c(),ue(n,{key:0,"disabled-close":!0,"song-info":l(o),autoplay:!0},null,8,["song-info"])):(c(),u("div",Ae,[s(me,{class:"text-ellipsis",style:{"font-size":"1.6em"}},{default:v(()=>[l(o).link?(c(),u("a",{key:0,target:"_blank",href:l(o).link},y(l(o).title),9,Ee)):(c(),u("span",{key:1,textContent:y(l(o).title)},null,8,Ne))]),_:1})])),s(fe,{class:"mb-2 mt-1"},{default:v(()=>[s(S,{to:"/channel/"+l(o).channelId},{default:v(()=>[L(y(l(o).channelName),1)]),_:1},8,["to"]),L(" "+y(l(o).pubDateTime),1)]),_:1})]),i("div",Ue,[s(pe,{ref:"description",innerHTML:l(o).descriptionText||l(o).description,class:"read-warp"},null,8,["innerHTML"])])]))])],2)]),_:1},8,["loading"]),s(ve,{location:"top",timeout:2e3,modelValue:m.show,"onUpdate:modelValue":t[4]||(t[4]=f=>m.show=f)},{default:v(()=>[L(y(m.msg),1)]),_:1},8,["modelValue"])],64)}}},Fe=X(Be,[["__scopeId","data-v-b6f5d751"]]);export{Fe as R,Ie as f};
