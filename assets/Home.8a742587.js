import{_ as h,u as m,s as c,a as f,i as r,b as p,f as w,r as g,o as i,c as $,d as _,e as l,w as d,V as N,g as n,F as x,h as y,j as P,t as k}from"./index.6d09a9c1.js";import{f as B}from"./Reader.c754ec0f.js";import{_ as L,u as M}from"./IndexView.9b1b8ded.js";import"./VSnackbar.4aaf2421.js";const{setBar:D}=m(),V={data:()=>({data:[],params:{source:void 0,folder:void 0,page:0,size:20},isLast:!0,loading:!0}),components:{IndexView:L},setup(){const{token:t}=c(f()),a=r("currentViewName"),o=r("sortName"),{t:e}=p();return{viewName:a,sortName:o,t:e,token:t}},mounted(){M(window,document.documentElement,()=>{this.loadMore()}),this.initData()},computed:{hideLoadMoreBtn(){return this.viewName=="column-view"}},methods:{async initData(){if(!this.token&&this.$route.fullPath!="/explore"){this.$router.push("/welcome");return}let t=this.t("layout.home"),a="mdi:mdi-home-outline";this.$route.fullPath=="/"?(this.params.source="HOME",this.params.source=void 0,this.params.folder=void 0):this.$route.fullPath=="/explore"?(this.params.source="EXPLORE",t=this.t("layout.explore"),a="mdi:mdi-compass-outline"):this.$route.path.indexOf("/folder")==0?(this.params.source="HOME",t=this.$route.params.id,this.params.folder=t,t=t=="root"?this.t("layout.defaultFolderName"):t,a="mdi:mdi-folder-outline"):this.$route.fullPath=="/star"&&(t=this.t("layout.star"),a="mdi:mdi-star-outline"),this.params.sort=void 0,this.sortName&&this.$route.fullPath!="/star"&&(this.params.sort=this.sortName+",desc"),D(t,a),this.params.page=0,this.data=await this.loadData()},async loadData(){this.loading=!0;const t=this.$route.fullPath;let a=this.$route.fullPath.includes("star")?await B(this.params):await w(this.params);return t==this.$route.fullPath?(this.loading=!1,this.isLast=a.last,a.content):(this.loading=!1,[])},async loadMore(){this.isLast||(this.params.page+=1,this.data=[...this.data,...await this.loadData()])}},watch:{$route(t){this.params.folder==t.params.id&&t.path.includes("/folder")||(t.path=="/"||t.path=="/explore"||t.path.includes("/folder")||t.path=="/star")&&(this.data=[],this.loading=!0,this.initData())},sortName(){this.data=[],this.loading=!0,this.initData()}}};function E(t,a,o,e,C,s){const u=g("index-view");return i(),$(x,null,[_(u,{data:t.data,"load-more":s.loadMore,loading:t.loading,"is-last":t.isLast,xl:3,lg:3,md:4,sm:6,cols:12},null,8,["data","load-more","loading","is-last"]),s.hideLoadMoreBtn?n("",!0):(i(),l(N,{key:0,class:"ma-3"},{default:d(()=>[t.isLast?n("",!0):(i(),l(y,{key:0,class:"mx-auto",onClick:s.loadMore},{default:d(()=>[P(k(e.t("loadMoreBtn")),1)]),_:1},8,["onClick"]))]),_:1}))],64)}const H=h(V,[["render",E]]);export{H as default};
