import{_ as h,u as m,s as c,a as f,i as r,b as p,f as w,r as g,o,c as _,d as N,e as l,w as d,V as $,g as n,F as x,h as y,j as k,t as B}from"./index.3ad06852.js";import{f as L}from"./Reader.f409e326.js";import{_ as M,u as D}from"./IndexView.07ea7dfa.js";import"./VSnackbar.d8195d91.js";const{setBar:V}=m(),P={data:()=>({data:[],params:{source:void 0,folder:void 0,page:0,size:20},isLast:!0,loading:!0}),components:{IndexView:M},setup(){const{token:t}=c(f()),a=r("currentViewName"),i=r("sortName"),{t:e}=p();return{viewName:a,sortName:i,t:e,token:t}},mounted(){D(window,document.documentElement,()=>{this.loadMore()}),this.initData()},computed:{hideLoadMoreBtn(){return this.viewName=="column-view"}},methods:{async initData(){if(!this.token&&this.$route.fullPath!="/explore"){this.$router.push("/welcome");return}let t=this.t("layout.home"),a="mdi:mdi-home-outline";this.$route.fullPath=="/"?(this.params.source="HOME",this.params.source=void 0,this.params.folder=void 0):this.$route.fullPath=="/explore"?(this.params.source="EXPLORE",t=this.t("layout.explore"),a="mdi:mdi-compass-outline"):this.$route.path.indexOf("/folder")==0?(this.params.source="HOME",t=this.$route.params.id,this.params.folder=t,t=t=="root"?this.t("layout.defaultFolderName"):t,a="mdi:mdi-folder-outline"):this.$route.fullPath=="/star"&&(t=this.t("layout.star"),a="mdi:mdi-star-outline"),this.params.sort=void 0,this.sortName&&this.$route.fullPath!="/star"&&(this.params.sort=this.sortName+",desc"),V(t,a),this.params.page=0,this.data=await this.loadData()},async loadData(){this.loading=!0;let t=this.$route.fullPath.includes("star")?await L(this.params):await w(this.params);return this.loading=!1,this.isLast=t.last,t.content},async loadMore(){this.isLast||(this.params.page+=1,this.data=[...this.data,...await this.loadData()])}},watch:{$route(t){this.params.folder==t.query.name&&t.path=="/folder"||(t.path=="/"||t.path=="/explore"||t.path=="/folder"||t.path=="/star")&&(this.data=[],this.loading=!0,this.initData())},sortName(){this.data=[],this.loading=!0,this.initData()}}};function E(t,a,i,e,C,s){const u=g("index-view");return o(),_(x,null,[N(u,{data:t.data,"load-more":s.loadMore,loading:t.loading,"is-last":t.isLast,xl:3,lg:3,md:4,sm:6,cols:12},null,8,["data","load-more","loading","is-last"]),s.hideLoadMoreBtn?n("",!0):(o(),l($,{key:0,class:"ma-3"},{default:d(()=>[t.isLast?n("",!0):(o(),l(y,{key:0,class:"mx-auto",onClick:s.loadMore},{default:d(()=>[k(B(e.t("loadMoreBtn")),1)]),_:1},8,["onClick"]))]),_:1}))],64)}const H=h(P,[["render",E]]);export{H as default};
