import{k as w,l as J,_ as K,m as O,b as Q,s as P,a as W,n as X,p as S,q as h,v as Z,x as ee,y as B,z as te,r as z,o as c,c as m,d as s,w as f,A as d,B as E,C as I,D as l,E as ae,G as k,g as oe,e as le,H as ne,t as v,I as se,j as L,J as ie,K as re,F as ce}from"./index.98bd2709.js";import{V as de}from"./VSnackbar.68b86e6d.js";function ue(o){return w.post("/star",null,{params:{itemId:o}})}function me(o){return w.delete("/star",{params:{itemId:o}})}function Me(o){return w.get("/star/articles",{params:o})}function fe(o){return w.get("/proxy/html-text",{params:o})}async function pe(o,i){return i=="text"?await _e(o):i=="html"?await U(o):await U(o)}async function U(o){return(location.hostname.includes("localhost")?"http://localhost:8080/api":"https://api.webfollow.cc/api")+"/proxy/html-text?url="+o}async function _e(o){let i=await fe({url:o});return he(i).content}function he(o){var i=document.implementation.createHTMLDocument("doc");i.documentElement.innerHTML=o;var p=new J.Readability(i.cloneNode(!0)).parse();return p}const ve={class:"read"},ye=["title"],xe=["title"],Te=["title"],ke=["title"],we={key:0,class:""},ge=["src"],be={key:1},Ve={key:1,class:"mr-3 mt-3"},Ce=["href"],Se=["textContent"],Le={class:"mx-auto normalize"},Re={__name:"Reader",props:["modelValue","overY","ctrlStyle"],emits:["update:modelValue"],setup(o,{emit:i}){const p=o,q=O(),{t:F}=Q();function y(e){return F("reader."+e)}const{token:Y}=P(W()),{mobile:$}=X(),a=S(()=>p.modelValue),R=S(()=>p.overY),A=S(()=>p.ctrlStyle||{}),g=h(!1),r=h(void 0),u=Z({show:!1,msg:void 0}),x=e=>i("update:modelValue",e),D=h(),b=h(),V=h("00:00");function C(){return R.value?b.value:D.value.$el}async function H(){let e=a.value;try{e.star?await me(e.id):await ue(e.id),e.star=!e.star,x(e)}catch{u.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",u.show=!0}}async function T(e){if(e==r.value){let t=a.value;r.value=void 0,t.descriptionText=void 0,x(t);return}await M(e)}async function M(e){let t=a.value;g.value=!0;try{let n=await pe(t.link,e);r.value=e,t.descriptionText=n,x(t)}catch{u.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",u.show=!0}g.value=!1}function N(){x({})}function j(){let e=b.value.getElementsByTagName("a");for(let t of e){let n=new URL(t.href);n.hash.indexOf("#t")==0&&n.host==window.location.host&&(t.href=window.location.href.split("?")[0]+n.hash.replace("#t","?t"))}}return ee(()=>{B(a,e=>{e.id&&(C().scrollTop=0),r.value&&M(r.value)}),B(q,e=>{e.query.t&&a.value.itunesDuration&&(V.value=e.query.t)}),j(),te(async e=>{if(e.detail=="rendText")T("text");else if(e.detail=="rendHtml")T("html");else if(e.detail=="readerQuit")N();else if(e.detail=="readerStar")H();else if(e.detail=="top"){let t=C();for(let n=0;n<40;n+=10)setTimeout(()=>{t.scrollTop-=10},n*2)}else if(e.detail=="bottom"){let t=C();for(let n=0;n<40;n+=10)setTimeout(()=>{t.scrollTop+=10},n*2)}else if(e.detail=="openTarget"){let t=window.open("about:blank");t.location.href=a.value.link}})}),(e,t)=>{const n=z("c-m-player"),G=z("router-link");return c(),m(ce,null,[s(E,{ref_key:"reader0",ref:D,loading:g.value},{default:f(()=>[d("div",{ref_key:"reader1",ref:b,class:I(["read-box",{"over-y":l(R)}]),tabindex:"0"},[d("div",ve,[s(E,{class:I(["ctrl side",{"ctrl-mobile":l($)}]),style:ae(l(A))},{default:f(()=>[d("div",{class:"ctrl-item",title:y("fetchSourceText")},[s(k,{icon:"mdi:mdi-book-open",color:r.value=="text"?"primary":"",onClick:t[0]||(t[0]=_=>T("text"))},null,8,["color"])],8,ye),d("div",{class:"ctrl-item",title:y("iframe")},[s(k,{icon:"mdi:mdi-google-chrome",color:r.value=="html"?"primary":"",onClick:t[1]||(t[1]=_=>T("html"))},null,8,["color"])],8,xe),l(Y)?(c(),m("div",{key:0,class:"ctrl-item",title:y("start")},[s(k,{icon:"mdi:mdi-star"+(l(a).star?"":"-outline"),variant:"outlined",color:l(a).star?"primary":"",onClick:H},null,8,["icon","color"])],8,Te)):oe("",!0),d("div",{class:"ctrl-item",title:y("close")},[s(k,{icon:"mdi:mdi-close",onClick:N})],8,ke)]),_:1},8,["class","style"]),r.value=="html"?(c(),m("div",we,[d("iframe",{src:l(a).descriptionText,frameborder:"0",class:"read-box",width:"100%"},null,8,ge)])):(c(),m("div",be,[d("div",null,[l(a).itunesDuration?(c(),le(n,{key:0,"song-info":l(a),autoplay:!0,currentTime:V.value,"onUpdate:currentTime":t[2]||(t[2]=_=>V.value=_)},null,8,["song-info","currentTime"])):(c(),m("div",Ve,[s(ne,{class:"text-ellipsis",style:{"font-size":"1.6em"}},{default:f(()=>[l(a).link?(c(),m("a",{key:0,target:"_blank",href:l(a).link},v(l(a).title),9,Ce)):(c(),m("span",{key:1,textContent:v(l(a).title)},null,8,Se))]),_:1})])),s(se,{class:"mb-2 mt-1"},{default:f(()=>[s(G,{to:"/channel/"+l(a).channelId},{default:f(()=>[L(v(l(a).channelName),1)]),_:1},8,["to"]),L(" "+v(l(a).pubDateTime),1)]),_:1})]),d("div",Le,[s(ie,{ref:"description",onClick:t[3]||(t[3]=re(()=>{},["stop"])),innerHTML:l(a).descriptionText||l(a).description,class:"read-warp"},null,8,["innerHTML"])])]))])],2)]),_:1},8,["loading"]),s(de,{location:"top",timeout:2e3,modelValue:u.show,"onUpdate:modelValue":t[4]||(t[4]=_=>u.show=_)},{default:f(()=>[L(v(u.msg),1)]),_:1},8,["modelValue"])],64)}}},Ne=K(Re,[["__scopeId","data-v-8a82b52d"]]);export{Ne as R,Me as f};
