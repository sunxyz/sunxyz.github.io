import{k,l as J,_ as K,m as O,n as Q,b as W,s as X,a as Z,p as ee,q as R,v,x as te,y as ae,z as oe,A as le,r as E,o as c,c as f,d as s,w as p,B as u,C as U,D as I,E as n,G as ne,H as w,g as se,e as ie,I as re,t as _,J as ce,j as L,K as ue,F as de}from"./index.cbedb1c9.js";import{V as me}from"./VSnackbar.689f6a47.js";function fe(o){return k.post("/star",null,{params:{itemId:o}})}function pe(o){return k.delete("/star",{params:{itemId:o}})}function Be(o){return k.get("/star/articles",{params:o})}function he(o){return k.get("/proxy/html-text",{params:o})}async function ve(o,i){return i=="text"?await _e(o):i=="html"?await F(o):await F(o)}async function F(o){return(location.hostname.includes("localhost")?"http://localhost:8080/api":"https://api.webfollow.cc/api")+"/proxy/html-text?url="+o}async function _e(o){let i=await he({url:o});return ye(i).content}function ye(o){var i=document.implementation.createHTMLDocument("doc");i.documentElement.innerHTML=o;var h=new J.Readability(i.cloneNode(!0)).parse();return h}const xe={class:"read"},Te=["title"],we=["title"],ke=["title"],ge=["title"],be={key:0,class:""},Ve=["src"],Ce={key:1},Se={key:1,class:"mr-3 mt-3"},Re=["href"],Le=["textContent"],He={class:"mx-auto normalize"},De={__name:"Reader",props:["modelValue","overY","ctrlStyle"],emits:["update:modelValue"],setup(o,{emit:i}){const h=o,P=O(),Y=Q(),{t:$}=W();function y(e){return $("reader."+e)}const{token:j}=X(Z()),{mobile:q}=ee(),a=R(()=>h.modelValue),H=R(()=>h.overY),A=R(()=>h.ctrlStyle||{}),g=v(!1),r=v(void 0),d=te({show:!1,msg:void 0}),x=e=>i("update:modelValue",e),D=v(),b=v(),V=v("00:00");function C(){return H.value?b.value:D.value.$el}async function M(){let e=a.value;try{e.star?await pe(e.id):await fe(e.id),e.star=!e.star,x(e)}catch{d.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",d.show=!0}}async function T(e){if(e==r.value){let t=a.value;r.value=void 0,t.descriptionText=void 0,x(t);return}await N(e)}async function N(e){let t=a.value;g.value=!0;try{let l=await ve(t.link,e);r.value=e,t.descriptionText=l,x(t)}catch{d.msg="\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",d.show=!0}g.value=!1}function B(){x({})}function G(){let e=b.value.getElementsByTagName("a");for(let t of e){let l=new URL(t.href);if(l.hash.indexOf("#t")==0&&l.host==window.location.host){let m=function(){Y.pushHash(S),z()},S=window.location.hash.replace("#","").split("?")[0]+l.hash.replace("#t","?t");t.href="javascript: void(0)",t.onclick=m}}z()}function z(){let e=P,t=window.location.href.replace("/#/","/"),l=new URL(t).searchParams.get("t")||e.query.t;console.log("goTimePlay",l,window.location.href),l&&a.value.itunesDuration&&(V.value=l)}return ae(()=>{oe(a,e=>{e.id&&(C().scrollTop=0),r.value&&N(r.value)}),G(),le(async e=>{if(e.detail=="rendText")T("text");else if(e.detail=="rendHtml")T("html");else if(e.detail=="readerQuit")B();else if(e.detail=="readerStar")M();else if(e.detail=="top"){let t=C();for(let l=0;l<40;l+=10)setTimeout(()=>{t.scrollTop-=10},l*2)}else if(e.detail=="bottom"){let t=C();for(let l=0;l<40;l+=10)setTimeout(()=>{t.scrollTop+=10},l*2)}else if(e.detail=="openTarget"){let t=window.open("about:blank");t.location.href=a.value.link}})}),(e,t)=>{const l=E("c-m-player"),S=E("router-link");return c(),f(de,null,[s(U,{ref_key:"reader0",ref:D,loading:g.value},{default:p(()=>[u("div",{ref_key:"reader1",ref:b,class:I(["read-box",{"over-y":n(H)}]),tabindex:"0"},[u("div",xe,[s(U,{class:I(["ctrl side",{"ctrl-mobile":n(q)}]),style:ne(n(A))},{default:p(()=>[u("div",{class:"ctrl-item",title:y("fetchSourceText")},[s(w,{icon:"mdi:mdi-book-open",color:r.value=="text"?"primary":"",onClick:t[0]||(t[0]=m=>T("text"))},null,8,["color"])],8,Te),u("div",{class:"ctrl-item",title:y("iframe")},[s(w,{icon:"mdi:mdi-google-chrome",color:r.value=="html"?"primary":"",onClick:t[1]||(t[1]=m=>T("html"))},null,8,["color"])],8,we),n(j)?(c(),f("div",{key:0,class:"ctrl-item",title:y("start")},[s(w,{icon:"mdi:mdi-star"+(n(a).star?"":"-outline"),variant:"outlined",color:n(a).star?"primary":"",onClick:M},null,8,["icon","color"])],8,ke)):se("",!0),u("div",{class:"ctrl-item",title:y("close")},[s(w,{icon:"mdi:mdi-close",onClick:B})],8,ge)]),_:1},8,["class","style"]),r.value=="html"?(c(),f("div",be,[u("iframe",{src:n(a).descriptionText,frameborder:"0",class:"read-box",width:"100%"},null,8,Ve)])):(c(),f("div",Ce,[u("div",null,[n(a).itunesDuration?(c(),ie(l,{key:0,"song-info":n(a),autoplay:!0,currentTime:V.value,"onUpdate:currentTime":t[2]||(t[2]=m=>V.value=m)},null,8,["song-info","currentTime"])):(c(),f("div",Se,[s(re,{class:"text-ellipsis",style:{"font-size":"1.6em"}},{default:p(()=>[n(a).link?(c(),f("a",{key:0,target:"_blank",href:n(a).link},_(n(a).title),9,Re)):(c(),f("span",{key:1,textContent:_(n(a).title)},null,8,Le))]),_:1})])),s(ce,{class:"mb-2 mt-1"},{default:p(()=>[s(S,{to:"/channel/"+n(a).channelId},{default:p(()=>[L(_(n(a).channelName),1)]),_:1},8,["to"]),L(" "+_(n(a).pubDateTime),1)]),_:1})]),u("div",He,[s(ue,{ref:"description",innerHTML:n(a).descriptionText||n(a).description,class:"read-warp"},null,8,["innerHTML"])])]))])],2)]),_:1},8,["loading"]),s(me,{location:"top",timeout:2e3,modelValue:d.show,"onUpdate:modelValue":t[3]||(t[3]=m=>d.show=m)},{default:p(()=>[L(_(d.msg),1)]),_:1},8,["modelValue"])],64)}}},ze=K(De,[["__scopeId","data-v-f87e44ea"]]);export{ze as R,Be as f};
