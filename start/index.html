<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>添加您的信息来源</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Slick Carousel -->
  <link rel="stylesheet" href="/plugins/slick/slick.css" />
  <link rel="stylesheet" href="/plugins/slick/slick-theme.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.min.css" />

  <!-- Magnific Popup -->
  <link rel="stylesheet" href="/plugins/magnafic-popup/magnific-popup.css" />

  <!-- Stylesheets -->
  
  <link href="/scss/style.min.css" rel="stylesheet" />

  <!--Favicon-->
  <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/images/favicon.png" type="image/x-icon" />
  
  <script  src="/plugins/vue/vue.min.js"></script>
  <script  src="/plugins/axios/axios.min.js"></script>
  <script>
    var BaseURL = window.location.host.includes('localhost')?'http://localhost:8080':'http://101.42.138.120'
    axios.defaults.baseURL = BaseURL
    
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?392ac0df04b6b46eb9cc5a38c42b8004";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
</head>

<body>
  <nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
    <a href="/" class="navbar-brand">
      <img src="/images/logo.png" alt="site-logo">
    </a>
    <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#navbarCollapse">
      <span class="navbar-toggler-icon"></span>
      <span class="navbar-toggler-icon"></span>
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
      <ul class="nav navbar-nav main-navigation my-0 mx-auto">
        
        
        <li class="nav-item">
          <a href="/#home"
            class="nav-link text-dark text-sm-center p-2 ">主页</a>
        </li>
        
        <li class="nav-item">
          <a href="/#use"
            class="nav-link text-dark text-sm-center p-2 ">使用</a>
        </li>
        
        <li class="nav-item">
          <a href="/#explore"
            class="nav-link text-dark text-sm-center p-2 ">探索</a>
        </li>
        
        <li class="nav-item">
          <a href="/#start"
            class="nav-link text-dark text-sm-center p-2 ">快速开始</a>
        </li>
        
      </ul>
      <div class="navbar-nav">
        <a href="/start" class="btn btn-primary btn-zoom hire_button">免费使用</a>
      </div>
    </div>
  </div>
</nav>
  <div id="content">
    

<header class="breadCrumb">
  <div class="svg-img">
    <img src="/images/hero/figure-svg.svg" alt="bg">
  </div>
  <div class="animate-shape">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 600 600">
      <defs>
        <linearGradient id="d" x1="0.929" y1="0.111" x2="0.263" y2="0.935" gradientUnits="objectBoundingBox">
          <stop offset="0" stop-color="#f1f6f9" />
          <stop offset="1" stop-color="#f1f6f9" stop-opacity="0" />
        </linearGradient>
      </defs>
      <g data-name="blob-shape (3)">
        <path class="blob" fill="url(#d)"
          d="M455.4 151.1c43.1 36.7 73.4 92.8 60.8 136.3-12.7 43.5-68.1 74.4-111.3 119.4-43.1 45-74 104.1-109.8 109-35.9 5-76.7-44.2-111.8-89.2-35.2-45-64.7-85.8-70.8-132.6-6-46.8 11.6-99.6 46.7-136.3 35.2-36.6 88-57.2 142.4-58.8 54.5-1.7 110.6 15.6 153.8 52.2z" />
      </g>
    </svg>
  </div>
  <div class="animate-pattern">
    <img src="/images/service/background-pattern.svg" alt="background-shape">
  </div>
  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <h2 class="breadCrumb__title" style="font-size: 36px;">添加您的信息来源</h2>
        <nav aria-label="breadcrumb" class="d-flex justify-content-center">
          <ol class="breadcrumb align-items-center">
            <li class="breadcrumb-item"><a href="/">主页</a></li>
            <li class="breadcrumb-item active" aria-current="page">快速开始</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</header>

<div id="app">
  <section class="contact-form">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="contact-form-title">
            <h5>输入网址</h5>
          </div>
          <div class="contact-form-input">
  
              <div class="form-group">
                <input type="text" v-model="rssUrl" class="form-control"  placeholder="请输入网站rss地址" required />
              </div>
  
              <div style="display: none;" :style="{display:show?'block':'none'}">

             
              <div v-if="loading" class="spinner-grow text-primary" role="status">
              </div>
              <div v-else-if="msg" class="alert" :class="'alert-'+msgType" role="alert" v-text="msg">
               
              </div>
              <button v-else type="button" class="btn btn-primary btn-zoom" id="contact-form-button" @click="follow">确定</button>
            </div>
          </div>
        </div>
       
      </div>
    </div>
  </section>
  <section>
    <div class="container" style="display: none;" :style="{display:websiteFollows.length?'block':'none'}">
      <div class="row">
        <div class="col-12 text-center">
          <h2 class="breadCrumb__title" style="font-size: 36px;">个人中心</h2>
        </div>
      </div>
      <button  class="btn btn-primary" type="button" data-toggle="collapse" data-target=".multi-collapse" aria-expanded="false" >编辑订阅设置</button>
      <div class="row ">
        <div class="col-lg-6 mt-4">
          <div class="collapse multi-collapse" >
            <div class="card">
              <div class="card-header">
                限制数量
              </div>
              <div class="card-body">
                <input type="text" class="form-control" placeholder="请输入限制数量" v-model="followSetting.itemsLimit">
                <a href="#" class="btn btn-outline-secondary mt-4 " @click="updateLimit(followSetting.itemsLimit)">确定</a>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mt-4">
          <div class="collapse multi-collapse" >
            <div class="card">
              <div class="card-header">
                呈现形式
              </div>
              <div class="card-body">
                <div class="form-group" style="margin-bottom: 14px;">
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions"  value="0" v-model="followSetting.itemsTheme">
                    <label class="form-check-label">缩略</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="inlineRadioOptions" value="1" v-model="followSetting.itemsTheme">
                    <label class="form-check-label">详情</label>
                  </div>
                </div>
                <a href="#" class="btn btn-outline-secondary mt-4" @click="updateTheme(followSetting.itemsTheme)">确定</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-4">
        <div class="col">
          <div class="collapse multi-collapse">
            <div class="card">
              <div class="card-header">
                优先级
              </div>
              <div class="card-body" style="overflow-x: auto">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">网站</th>
                      <th scope="col">rss地址</th>
                      <th scope="col">排名</th>
                      <th scope="col">管理</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(item,index) in websiteFollows" :key="item.websiteId">
                      <th scope="row" v-text="index">1</th>
                      <td v-text="item.websiteName">Mark</td>
                      <td v-text="item.rssUrl">Otto</td>
                      <td ><input type="number" v-model.number="item.sort" style="width: 60px"/></td>
                      <td><button class="btn btn-error" @click="openUnfollow(item.websiteId)">取消订阅</button></td>
                    </tr>
                  </tbody>
                </table>
                <button type="button" class="btn btn-outline-secondary" @click="updateSort(websiteFollows)">确定</button>
              </div>
            </div>
          </div>
        </div>
      </div>
     
    </div>
  </section>
  
  
  
  <div class="modal fade" id="authModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">请邮箱验证</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" v-if="!authing">
          <div class="input-group">
            <input type="email" v-model="email" class="form-control" placeholder="请输入邮箱号" aria-describedby="basic-addon1">
          </div>
        </div>
        <div class="modal-footer" v-if="!authing">
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-primary " @click="auth">确认</button>
        </div>
        <p v-else class="modal-body" v-text="authMsg"></p>
      </div>
    </div>
  </div>

  
  <div class="modal fade" id="unfollowModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel0">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header" >
         确认取消该订阅？
        </div>
        <div class="modal-footer" >
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-primary " @click="unfollow(unfollowId)">确认</button>
        </div>
      </div>
    </div>
  </div>
</div>


<script>
  
  
  axios.interceptors.request.use(
    config => {
      var token = sessionStorage.getItem('token')
      if(token){
        config.headers['Authorization'] = `Bearer ${token}`;
      }
      return config;
    },
    error => {
        return Promise.reject(error);
    }
  );
  axios.interceptors.response.use(
    response => {
      return response;
    },
    error => {
      if(error.response.status==401){
        sessionStorage.removeItem('token')
          vm.showAuth()
        }else{
          vm.msgType = 'danger'
          vm.msg = error.response.data.message
          setTimeout(() => {
            vm.msg = undefined
          }, 5000);
        }
      return Promise.reject(error);
    }
  );
  
  function getUserFollowSetting(){
    return axios.get('/api/follow/settings')
  }
  function listUserWebsiteFollows(){
    return axios.get('/api/follow')
  }
  function follow(params){
    return axios.post('/api/follow',null,{
      params
    })
  }
  function unfollow(params){
    return axios.delete('/api/follow',{
      params
    })
  }
  function updateWebsiteSort(data){
    return axios.patch('/api/follow/sort', data)
  }
  function updateTheme(params){
    return axios.patch('/api/items/theme', null, {
      params
    })
  }
  function updateLimit(params){
    return axios.patch('/api/items/limit', null, {
      params
    })
  }
  var vm = new Vue({
    el:'#app',
    data:{
      msg:undefined,
      msgType:'success',
      loading:false,
      rssUrl: undefined,
      email:undefined,
      authing:false,
      authMsg:undefined,
      followSetting:{},
      websiteFollows:[],
      unfollowId:undefined,
      show:true,
    },
    methods:{
      follow(){
        if(!this.rssUrl){
          this.msgType = 'danger'
          this.msg = '请输入网站rss地址'
          setTimeout(() => {
            this.msg = undefined
          }, 5000);
        }
        this.authing=false
        var token = sessionStorage.getItem('token')
        if(token){
          this.loading=true
          follow({
            rssUrl:this.rssUrl
          }).then(r=>{
            this.loading=false
            this.loadFollows()
            this.rssUrl = undefined
            this.msgType = 'success'
            this.msg = r.data
            setTimeout(() => {
              this.msg = undefined
            }, 5000);
          }).catch(r=>{
            this.loading=false
          })
        }else{
          this.showAuth()
        }
      },
      showAuth(){
        sessionStorage.removeItem('token')
        $('#authModal').modal('toggle')
      },
      auth(){
        axios.post(`/api/auth`, null ,{
          params:{
            email:this.email
          }
        }).then(r=>{
          if(r.data){
          this.authing = true
          this.authMsg = '认证中...... 请注意查收邮件认证'
          this.loopWaitToken(r.data)
          }
        })
      },
      loopWaitToken(key){
        var loop = setInterval( ()=>{
          axios.get('/api/auth/token', {
            params:{
              key
            }
          }).then(r=>{
           if(r.data){
            console.log(r.data)
            sessionStorage.setItem('token', r.data)
            setTimeout(()=>{
              this.loadData()
              this.follow()
            },2000)
            this.authing=false
            clearInterval(loop)
            $('#authModal').modal('toggle')
           }
          })
        }, 5000)
        setTimeout(() => {
          clearInterval(loop)
          this.authMsg = '认证失败......'
        }, 60000);
      },
      async loadData(){
        this.loadFollows()
        this.loadFollowSetting()
      },
      async loadFollows(){
        this.websiteFollows  = (await listUserWebsiteFollows()).data
      },
      async loadFollowSetting(){
        this.followSetting  = (await getUserFollowSetting()).data
      },
      async updateSort(data){
        await updateWebsiteSort(data)
        this.loadFollows()
      },
      async updateTheme(theme){
        await updateTheme({
          theme
        })
        this.loadFollowSetting()
      },
      async updateLimit(limit){
        await updateLimit({
          limit
        })
        this.loadFollowSetting()
      },
      openUnfollow(id){
        this.unfollowId = id
        $('#unfollowModal').modal('toggle')
      },
      async unfollow(websiteId){
        await unfollow({
          websiteId
        })
        this.loadFollows()
        $('#unfollowModal').modal('toggle')
      }
    },
    mounted(){
      if(sessionStorage.getItem('token')){
        this.loadData()
      }
    }
  })
</script>


  </div>
  <section class="footer" id="start">
	<div class="footer__background_shape">
		<svg viewBox="0 0 1920 79">
			<path d="M0 0h1920v79L0 0z" data-name="Path 1450" />
		</svg>
	</div>
	<div class="container">
		
		<div class="row footer__widget">
			<div class="col-lg-4">
				<div class="footer__widget_logo mb-5">
					<img src="/images/foot-logo.png" alt="widget-logo">
				</div>
			</div>
			<div class="col-lg-4">
				<div class="text-light footer__widget_sitemap mb-5">
					<h4 class="base-font">网站导航</h4>
					<ul class="unstyle-list small">
						
						
						<li class="mb-2"><a class="text-light" href="/">主页</a></li>
						
						<li class="mb-2"><a class="text-light" href="/start">快速开始</a></li>
						
					</ul>
				</div>
			</div>
			<div class="col-lg-4">
				<div class="text-light footer__widget_address mb-5">
					<h4 class="base-font">Address</h4>
					
					<ul class="fa-ul small">
						<li class="mb-2"><a class="text-light" href="tel:"><span class="fa-li"><i
										class="fa fa-phone"></i></span></a></li>
						<li class="mb-2"><a class="text-light" href="mailto:webfollow@163.com"><span class="fa-li"><i
										class="fa fa-envelope"></i></span>webfollow@163.com</a></li>
						
					</ul>
				</div>
			</div>
		</div>
		<div class="row footer__footer">
			<div class="col-lg-6">
				<div class="footer__footer_copy text-light">
					<p> ©2022 webfollow </p>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="footer__footer_social">
					<ul class="unstyle-list">
						
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</section>
<script src="https://maps.googleapis.com/maps/api/js?key=&libraries=geometry"></script>
<script src="/plugins/jQuery/jquery.min.js"></script>
<script src="/plugins/bootstrap/bootstrap.min.js"></script>
<script src="/plugins/slick/slick.min.js"></script>
<script src="/plugins/waypoint/jquery.waypoints.min.js"></script>
<script src="/plugins/magnafic-popup/jquery.magnific-popup.min.js"></script>
<script src="/plugins/tweenmax/TweenMax.min.js"></script>
<script src="/plugins/imagesloaded/imagesloaded.min.js"></script>
<script src="/plugins/masonry/masonry.min.js"></script>

<script src="/js/form-handler.min.js"></script>

<script src="/js/script.min.js"></script>

</body>

</html>